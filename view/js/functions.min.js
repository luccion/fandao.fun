var menuBtnClicked=0;function getCookie(t){for(var e=t+"=",n=document.cookie.split(";"),a=0;a<n.length;a++){var o=n[a].trim();if(0==o.indexOf(e))return o.substring(e.length,o.length)}return""}function fontawesomeNumber(t){n=(t+="").split("");var e="";for(i=0;i<n.length;i++)e+='<i class="fa-solid fa-'+n[i]+'"></i>';return e}function newREPOAlert(t,e){switch(e){case"E1":$(".eventAlertModalMsg").html(text_login_please),$("#eventAlertModal").modal("show"),$(".eventAlertCancelBtn").click(()=>{location.reload()});break;case"E6":$(".eventAlertModalMsg").html(t+text_post_too_fast),$("#eventAlertModal").modal("show");break;case"E7":$(".eventAlertModalMsg").html(text_wrong_category),$("#eventAlertModal").attr({"data-backdrop":"static","data-keyboard":"false"}).modal("show"),$(".eventAlertCancelBtn").click(()=>{window.location.href="index.php"});break;case"E4":$(".eventAlertModalMsg").html(text_empty_content),$("#eventAlertModal").modal("show");break;case"success":$(window).scrollTop(0),location.reload();break;case"E2":$(".eventAlertModalMsg").html(text_error_fatal),$("#eventAlertModal").modal("show"),$(".eventAlertCancelBtn").click(()=>{window.location.href="index.php"});break;case"E3":$(".eventAlertModalMsg").html(text_no_enough_balance),$("#eventAlertModal").modal("show"),$(".eventAlertCancelBtn").click(()=>{location.reload()})}}function getNewNames(t=3){var e;$.ajax({url:path_http+"generateNameAndAvatar.php",async:!1,type:"POST",data:{count:t},success:function(t){e=JSON.parse(t)}});for(var n=0;n<t;n++){var a="#avatar_chinese_"+n,o="#avatar_english_"+n,r=e[n].md5;$(a).html(e[n].zh),$(o).html(e[n].en),$(a).parent().prev().attr({md5:r}).html(e[n].svg)}}function getModal(t,e){0!=(e||0)&&(t=">>"+t+">"+e+"\n",$("#content").val(t),document.getElementById("contentModal").value=t),$("#replyBox").modal()}function view(t,e){return $.ajax({url:"./getReply.php?tid="+t+"&f="+e,async:!1}).responseText}function changeUserInfo(t,e){"success"==$.ajax({url:path_http+"settingAct.php",method:"POST",data:"nickname="+t+"&email="+e,async:!1}).responseText?$("#uinfo").attr("class","alert alert-success").html(text_change_done):$("#uinfo").attr("class","alert alert-danger").html(text_chage_failed)}function changePassword(t,e){t=$.ajax({url:path_http+"changePwdAct.php",method:"POST",data:"oldpass="+t+"&newpass="+e,async:!1});"success"==t.responseText?$("#cpwd").attr("class","alert alert-success").html(text_change_done):$("#cpwd").attr("class","alert alert-danger").html(t.responseText)}jQuery.extend({handleError:function(t,e,n,a){t.error&&t.error.call(t.context||t,e,n,a),t.global&&(t.context?jQuery(t.context):jQuery.event).trigger("ajaxError",[e,t,a])},createUploadIframe:function(t,e){var n,t="jUploadFrame"+t;return window.ActiveXObject?((n=document.createElement("iframe")).id=t,n.name=t,"boolean"==typeof e?n.src="javascript:false":"string"==typeof e&&(n.src=e)):((n=document.createElement("iframe")).id=t,n.name=t),n.style.position="absolute",n.style.top="-1000px",n.style.left="-1000px",document.body.appendChild(n),n},createUploadForm:function(t,e,n){var a="jUploadForm"+t,t="jUploadFile"+t,o=$('<form  action="" method="POST" name="'+a+'" id="'+a+'" enctype="multipart/form-data"></form>'),a=$("#"+e),e=$(a).clone(!0);if($(a).attr("id",t),$(a).before(e),$(a).appendTo(o),n)for(var r in n)$('<input type="hidden" name="'+r+'" value="'+n[r]+'" />').appendTo(o);return $(o).css("position","absolute"),$(o).css("top","-1200px"),$(o).css("left","-1200px"),$(o).appendTo("body"),o},addOtherRequestsToForm:function(t,e){var n,a=$('<input type="hidden" name="" value="">');for(n in e){name=n,value=e[n];var o=a.clone();o.attr({name:name,value:value}),$(o).appendTo(t)}return t},ajaxFileUpload:function(o){o=jQuery.extend({},jQuery.ajaxSettings,o);function t(t){var e,n,a=document.getElementById(c);try{a.contentWindow?(l.responseText=a.contentWindow.document.body?a.contentWindow.document.body.innerHTML:null,l.responseXML=a.contentWindow.document.XMLDocument||a.contentWindow.document):a.contentDocument&&(l.responseText=a.contentDocument.document.body?a.contentDocument.document.body.innerHTML:null,l.responseXML=a.contentDocument.document.XMLDocument||a.contentDocument.document)}catch(t){jQuery.handleError(o,l,null,t)}if(l||"timeout"==t){i=!0;try{"error"!=(n="timeout"!=t?"success":"error")?(e=jQuery.uploadHttpData(l,o.dataType),o.success&&o.success(e,n),o.global&&jQuery.event.trigger("ajaxSuccess",[l,o])):jQuery.handleError(o,l,n)}catch(t){n="error",jQuery.handleError(o,l,n,t)}o.global&&jQuery.event.trigger("ajaxComplete",[l,o]),o.global&&!--jQuery.active&&jQuery.event.trigger("ajaxStop"),o.complete&&o.complete(l,n),jQuery(a).unbind(),setTimeout(function(){try{$(a).remove(),$(r).remove()}catch(t){jQuery.handleError(o,l,null,t)}},100),l=null}}var e=(new Date).getTime(),r=jQuery.createUploadForm(e,o.fileElementId,o.data),c=(o.data&&(r=jQuery.addOtherRequestsToForm(r,o.data)),jQuery.createUploadIframe(e,o.secureuri),"jUploadFrame"+e),e="jUploadForm"+e,i=(o.global&&!jQuery.active++&&jQuery.event.trigger("ajaxStart"),!1),l={};o.global&&jQuery.event.trigger("ajaxSend",[l,o]);0<o.timeout&&setTimeout(function(){i||t("timeout")},o.timeout);try{r=$("#"+e);$(r).attr("action",o.url),$(r).attr("method","POST"),$(r).attr("target",c),r.encoding?r.encoding="multipart/form-data":r.enctype="multipart/form-data",$(r).submit()}catch(t){jQuery.handleError(o,l,null,t)}return window.attachEvent?document.getElementById(c).attachEvent("onload",t):document.getElementById(c).addEventListener("load",t,!1),{abort:function(){}}},uploadHttpData:function(r,type){var data=!type,rx,am,data;return data="xml"==type||data?r.responseXML:r.responseText,"script"==type&&jQuery.globalEval(data),"json"==type&&(data=r.responseText,rx=new RegExp("<pre.*?>(.*?)</pre>","i"),am=rx.exec(data),data=am?am[1]:"",eval("data = "+data)),"html"==type&&jQuery("<div>").html(data).evalScripts(),data}}),!function(u){jQuery.fn.getCursorPosition=function(){return 0==this.lengh?-1:u(this).getSelectionStart()},jQuery.fn.setCursorPosition=function(t){return 0==this.lengh?this:u(this).setSelection(t,t)},jQuery.fn.getSelection=function(){var t,e;return 0==this.lengh?-1:(t=u(this).getSelectionStart(),e=u(this).getSelectionEnd(),this[0].value.substring(t,e))},jQuery.fn.getSelectionStart=function(){var t,e;return 0==this.lengh?-1:(t=(input=this[0]).value.length,input.createTextRange?((e=document.selection.createRange().duplicate()).moveEnd("character",input.value.length),""==e.text&&(t=input.value.length),t=input.value.lastIndexOf(e.text)):void 0!==input.selectionStart&&(t=input.selectionStart),t)},jQuery.fn.getSelectionEnd=function(){var t,e;return 0==this.lengh?-1:(t=(input=this[0]).value.length,input.createTextRange?((e=document.selection.createRange().duplicate()).moveStart("character",-input.value.length),""==e.text&&(t=input.value.length),t=input.value.lastIndexOf(e.text)):void 0!==input.selectionEnd&&(t=input.selectionEnd),t)},jQuery.fn.setSelection=function(t,e){var n;return 0!=this.lengh&&((input=this[0]).createTextRange?((n=input.createTextRange()).collapse(!0),n.moveEnd("character",e),n.moveStart("character",t),n.select()):input.setSelectionRange&&(input.focus(),input.setSelectionRange(t,e))),this};var p,m,n=!(jQuery.fn.insertAtCursor=function(t){var e,n,a,o=u(this)[0];document.selection?(this.focus(),(sel=document.selection.createRange()).text=t,this.focus()):o.selectionStart||"0"==o.selectionStart?(e=o.selectionStart,n=o.selectionEnd,a=o.scrollTop,o.value=o.value.substring(0,e)+t+o.value.substring(n,o.value.length),this.focus(),o.selectionStart=e+t.length,o.selectionEnd=e+t.length,o.scrollTop=a):(this.value+=t,this.focus())}),a={x:0,y:0},h={container:u('<div id="bcPaint-container"></div>'),palette:u('<div class="col-12 text-center p-1" id="bcPaint-palette"></div>'),stroke:u('<div class="bcPaint-stroke"><input type="range" name="strokeRange" class="custom-range" min="1" max="50" id="strokeRange" value = "4" ><a id="strokeValue"></a></div> '),color:u('<div class="bcPaint-palette-color"></div>'),canvasContainer:u('<div class="col-12 text-center" id="bcPaint-canvas-container"></div>'),canvasPane:u('<canvas id="bcPaintCanvas" class="border border-dark rounded"></canvas>'),bottom:u('<div class="col-sm-12 col-md-12 text-center m-2" id="bcPaint-bottom"></div>'),buttonReset:u('<button type="button" class="btn btn-secondary btn-sm mr-1" id="bcPaint-reset"><i class="fas fa-eraser"></i> Clear</button>'),buttonSave:u('<button type="button" class="btn btn-primary btn-sm ml-1" id="bcPaint-export"><i class="fas fa-download"></i> Export</button>')};u.fn.bcPaint=function(d){return this.each(function(){var e,t=u(this),n=u.extend({},u.fn.bcPaint.defaults,d),a=u.extend({},u.fn.bcPaint.defaults,d),o=0<t.val().length?t.val():n.defaultColor,a=a.defaultStroke,r=h.container.clone(),c=h.palette.clone(),i=h.canvasContainer.clone(),l=h.canvasPane.clone(),s=h.stroke.clone(),i=(t.append(r),r.append(i),i.append(l),r.append(c),c.append(s),u.each(n.colors,function(t){(e=h.color.clone()).css("background-color",u.fn.bcPaint.toHex(n.colors[t])),e.attr("data-color",n.colors[t]),c.append(e)}),t.find("canvas"));i.attr("width",300),i.attr("height",300),p=document.getElementById("bcPaintCanvas"),(m=p.getContext("2d")).fillStyle="#fff",m.fillRect(0,0,300,300),imgStack=[],imgStackIndex=-1,u.fn.bcPaint.setColor(o),u.fn.bcPaint.setStroke(a),p.onmousedown=u.fn.bcPaint.onMouseDown,p.onmouseup=u.fn.bcPaint.onMouseUp,p.onmousemove=u.fn.bcPaint.onMouseMove,p.addEventListener("touchstart",function(t){u.fn.bcPaint.dispatchMouseEvent(t,"mousedown")}),p.addEventListener("touchend",function(t){u.fn.bcPaint.dispatchMouseEvent(t,"mouseup")}),p.addEventListener("touchmove",function(t){u.fn.bcPaint.dispatchMouseEvent(t,"mousemove")}),document.body.addEventListener("touchstart",function(t){"paintCanvas"==t.target&&(t.preventDefault(),t.stopPropagation())},{passive:!1}),document.body.addEventListener("touchend",function(t){"paintCanvas"==t.target&&(t.preventDefault(),t.stopPropagation())},{passive:!1}),document.body.addEventListener("touchmove",function(t){"paintCanvas"==t.target&&(t.preventDefault(),t.stopPropagation())},{passive:!1})})},u.extend(!0,u.fn.bcPaint,{dispatchMouseEvent:function(t,e){t=t.touches[0],null==t&&(t={clientX:0,clientY:0}),e=new MouseEvent(e,{clientX:t.clientX,clientY:t.clientY});p.dispatchEvent(e)},clearCanvas:function(){p.width=p.width,m.fillStyle="#fff",m.fillRect(0,0,300,300),u(".selected").removeClass("selected"),u('.bcPaint-palette-color[data-color="000000"]').addClass("selected"),u("input[name=strokeRange]").val(2),imgStackIndex=-1,imgStack=[]},onMouseDown:function(t){n=!0;var e=document.getElementById("bcPaintCanvas").getBoundingClientRect();a.x=t.clientX-e.left,a.y=t.clientY-e.top,m.beginPath(),m.moveTo(a.x,a.y),m.lineTo(a.x,a.y),m.stroke(),m.beginPath(),m.moveTo(a.x,a.y)},onMouseUp:function(){imgStack.push(m.getImageData(0,0,300,300)),imgStackIndex+=1,20<imgStack.length&&(imgStack.shift(),--imgStackIndex),n=!1},onMouseMove:function(t){var e;n&&(e=document.getElementById("bcPaintCanvas").getBoundingClientRect(),m.lineTo(t.clientX-e.left,t.clientY-e.top),m.lineCap="round",m.lineJoin="round",m.stroke())},undo:function(){imgStackIndex<=0?this.clearCanvas():(--imgStackIndex,imgStack.pop(),m.putImageData(imgStack[imgStackIndex],0,0))},setColor:function(t){m.strokeStyle=u.fn.bcPaint.toHex(t)},setStroke:function(t){m.lineWidth=t},export:function(){return p.toDataURL("image/png")},toHex:function(t){var e;return t.match(/[0-9A-F]{6}|[0-9A-F]{3}$/i)?"#"===t.charAt(0)?t:"#"+t:!!t.match(/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/)&&(t=function(t){if(t.length<2)for(var e=0,n=2-t.length;e<n;e++)t="0"+t;return t},3===(e=[parseInt(RegExp.$1,10),parseInt(RegExp.$2,10),parseInt(RegExp.$3,10)]).length?"#"+t(e[0].toString(16))+t(e[1].toString(16))+t(e[2].toString(16)):void 0)}}),u.fn.bcPaint.defaults={defaultColor:"000000",defaultStroke:4,colors:["000000","#ffffff","#dc3545","#fd7e14","#ffc107","#28a745","#20c997","#6f42c1","#007bff"],addColors:[]}}(jQuery),window.onload=function(){"https://fandao.fun/me.php"==window.location.href&&$(window).width()<=768?($("#menuBtn").css("transform","rotate(90deg)"),menuBtnClicked=1,$("#lmenu").collapse("show")):menuBtnClicked=0,$(".fandaoImg").each(function(){let t=450,e=$(this).width(),n=$(this).height(),a=$(window).width();var o=600/n<=(t=a<=576?a-128:450)/e?600/n:t/e;$(this).css("width",e),(e>t||600<n)&&($(this).css("width",o*e),$(this).addClass("fandaoImg-enlarge"),$(this).on("click",function(){window.open($(this).attr("src"))}))}),$(".fandaoDoodle").each(function(){$(this).append(text_doodle_solitaire)}),$(".fandaoDoodleSolitaire").each(function(){$(this).on("click",function(){var t=$(this).prev().attr("src"),e=$(this).parents(".discussion").attr("tid"),n=$(this).parents(".reply").attr("floor");let a=new Image,o=(a.src=t,document.getElementById("bcPaintCanvas").getContext("2d"));o.drawImage(a,0,0),getModal(e,n),$("#painter").modal()})}),$(".date").each(function(){var t=$(this).attr("date");display=moment(t,"YYYYMMDDHHmmss").locale("zh-cn").fromNow(),$(this).html(display)})};