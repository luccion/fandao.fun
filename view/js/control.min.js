$(function(){$("#menuBtn").click(()=>{0==menuBtnClicked?($("#menuBtn").css("transform","rotate(90deg)"),menuBtnClicked=1,$("#lmenu").collapse("show")):($("#menuBtn").css("transform","rotate(0deg)"),menuBtnClicked=0,$("#lmenu").collapse("hide"))}),$('[data-toggle="popover"]').popover(),$(".btnVote").popover("show"),$(".quoteview").mouseleave(function(){$(this).stop().fadeOut(250)}),$(".quote").mouseenter(function(t){window.ctop=t.pageY,window.cleft=t.pageX;var e,t=/>>(\d+)(?:>(\d+))?/.exec(this.innerText),a=t[1],t=void 0===t[2]?0:t[2],o=document.createElement("div"),l=$(".discussion[tid="+a+"]");void 0===(e=0<l.length?l.find("[floor="+t+"]").html():e)&&(e=view(a,t)),o.setAttribute("class","reply"),o.setAttribute("style","margin:0"),o.innerHTML=e,$(".quoteview").html(""),$(".quoteview").append(o),$(".quoteview").css("top",ctop).css("left",cleft).stop().fadeIn(250)}),$(".quote").mouseleave(function(t){top=t.pageY,left=t.pageX,(top<window.ctop||left<window.cleft)&&$(".quoteview").mouseleave()}),$(".profileview").mouseleave(function(){$(this).stop().fadeOut(250)}),$(".avatarSVG").mouseenter(function(t){window.ctop=t.pageY,window.cleft=t.pageX,svg=$(this).html(),profileName=$(this).next().html(),$(".profileview").children(".profileName").html(""),$(".profileview").children(".avatarSVG-show").html(""),$(".profileview").children(".avatarSVG-show").html(svg),$(".profileview").children(".profileName").html(profileName),$(".profileview").css("top",ctop).css("left",cleft).stop().fadeIn(250)}),$(".avatarSVG").mouseleave(function(t){top=t.pageY,left=t.pageX,(top<window.ctop||left<window.cleft)&&$(".profileview").mouseleave()}),$("#fileUploader,#fileUploaderModal").on("change",function(){var t=(t=$(this).val()).replace("C:\\fakepath\\","");$(this).next(".custom-file-label").html(t)}),$("#uploadIMG").click(function(){$.ajaxFileUpload({secureuri:!1,type:"POST",url:path_http+"upload.php",fileElementId:"fileUploader",dataType:"text",async:!0,success:function(t){t=JSON.parse(t),$("#fileUploader").next(".custom-file-label").html(text_upload_success),t="[[img:"+t.file_name+"]]";$("#content").insertAtCursor(t)},error:function(t){$("#fileUploader").next(".custom-file-label").html(text_upload_fail),console.log(t)}})}),$("#uploadIMGModal").click(function(){$.ajaxFileUpload({secureuri:!1,type:"POST",url:path_http+"upload.php",fileElementId:"fileUploaderModal",dataType:"text",async:!0,success:function(t){t=JSON.parse(t),$("#fileUploaderModal").next(".custom-file-label").html(text_upload_success),t="[[img:"+t.file_name+"]]";$("#contentModal").insertAtCursor(t)},error:function(t,e){console.log(e+t)}})}),$("#bcPaint").bcPaint(),$("#painter").on("hidden.bs.modal",function(){$("#body").attr("class","modal-open")}),$("body").on("click",".bcPaint-palette-color",function(){$(this).parent().find(".selected").removeClass("selected"),$(this).addClass("selected"),$.fn.bcPaint.setColor($(this).css("background-color"))}),$("body").on("click","#bcPaint-reset",function(){$.fn.bcPaint.clearCanvas()}),$("input[name=strokeRange]").change(function(){$.fn.bcPaint.setStroke($(this).val())}),$("#bcPaint-export").click(function(){var t=$.fn.bcPaint.export();$.post(path_http+"upload_base64.php",{imgBase64:t},function(t){t="[[doodle:"+JSON.parse(t).file_name+"]]";$("#content").insertAtCursor(t),$("#contentModal").insertAtCursor(t)})}),$("#UNDO").click(function(){$.fn.bcPaint.undo()}),$("#addDice").click(()=>{$("#content").insertAtCursor(text_dice)}),$("#addDiceModal").click(()=>{$("#contentModal").insertAtCursor(text_dice)}),$("#addLinkBtn,#addLinkBtnModal").click(()=>{$("#addLinkModal").modal("show")}),$("#addLinkConfirm").click(()=>{let t=$("#addLinkLink").val(),e=$("#addLinkDesc").val();e=e&&"|"+e,content="[["+t+e+"]]",$("#content").insertAtCursor(content),$("#contentModal").insertAtCursor(content)}),$("#textface").change(()=>{var t=$("#textface").val();$("#content").insertAtCursor(t)}),$("#textfaceModal").change(()=>{var t=$("#textfaceModal").val();$("#contentModal").insertAtCursor(t)}),$(function(){$('[data-toggle="tooltip"]').tooltip()}),"DARKMODE"===getCookie("THEME")?($(".themeModeDescription").html(text_theme_darkmode),$(".switchLight").removeAttr("checked")):$(".themeModeDescription").html(text_theme_lightmode),$(".switchLight").click(()=>{$(".switchLight").is(":checked")?($("#theme-link").attr("href",path_css+"light-theme.css"),$(".themeModeDescription").html(text_theme_lightmode),document.cookie="THEME=LIGHTMODE"):($("#theme-link").attr("href",path_css+"dark-theme.css"),$(".themeModeDescription").html(text_theme_darkmode),document.cookie="THEME=DARKMODE")}),$(".logoutBtn").click(()=>{console.log("logout"),$.get("logout.php",()=>{window.location.href="index.php"})}),$(".refreshBtn").click(()=>{location.reload()}),$("#hall").click(()=>{$(".col-md-9").load(path_view+"hall.php")}),$(".subscribeBtn").click(()=>{var t=$(".subscribeBtn").attr("clicked"),e=$(".discussion").attr("tid");$.post(path_http+"subscribe.php",{tid:e},()=>{0==t?($(".subscribeBtn").html(text_unsubscribe),$(".subscribeBtn").attr("clicked",1).removeClass("color-badge-default").addClass("color-badge-active")):($(".subscribeBtn").html(text_subscribe),$(".subscribeBtn").attr("clicked",0).removeClass("color-badge-active").addClass("color-badge-default"))})});var a=$(".likeBtn").html()||text_thumbsUpIcon,a=parseInt(a.replace(text_thumbsUpIcon,""));$(".likeBtn").click(()=>{var t=$(".likeBtn").attr("clicked"),e=$(".discussion").attr("tid");$.post(path_http+"likeThread.php",{tid:e},()=>{0==t?(a+=1,$(".likeBtn").html(text_thumbsUpIcon+a),$(".likeBtn").attr("clicked",1).removeClass("color-badge-default").addClass("color-badge-active")):(--a,$(".likeBtn").html(text_thumbsUpIcon+a),$(".likeBtn").attr("clicked",0).removeClass("color-badge-active").addClass("color-badge-default"))})}),$(".newDiscussBtn").click(()=>{repo=text_post;var t=$(".newDiscussCatagory").val(),e=$(".newDiscussTitle").val(),a=$(".newDiscussContent").val();$.post(path_http+"newdiscus.php",{title:e,content:a,cat:t},t=>{newREPOAlert(repo,t)})}),$(".newDiscussBtnModal").click(()=>{repo=text_post;var t=$(".newDiscussCatagoryModal").val(),e=$(".newDiscussTitleModal").val(),a=$(".newDiscussContentModal").val();$.post(path_http+"newdiscus.php",{title:e,content:a,cat:t},t=>{newREPOAlert(repo,t)})}),$(".newReplyBtn").click(()=>{repo=text_reply;var t=$(".newReplyTid").val(),e=$(".newReplyContent").val();$.post(path_http+"newreply.php",{tid:t,content:e},t=>{newREPOAlert(repo,t)})}),$(".newReplyBtnModal").click(()=>{repo=text_reply;var t=$(".newReplyTidModal").val(),e=$(".newReplyContentModal").val();$.post(path_http+"newreply.php",{tid:t,content:e},t=>{newREPOAlert(repo,t)})}),$(".newProposalBtn").click(()=>{var t=$("#newProposalTitle").val(),e=$("#newProposalContent").val(),a=text_reply;t||($(".eventAlertModalMsg").html(text_empty_title),$("#eventAlertModal").modal("show")),e||($(".eventAlertModalMsg").html(text_empty_content),$("#eventAlertModal").modal("show")),$.post(path_http+"newproposal.php",{title:t,content:e},function(t){newREPOAlert(a,t)})}),$(".proposalVoteBtn").on("click",function(){var t=$(this).parent().parent().parent().attr("pid"),e=parseInt($(this).attr("clicked")),a=parseInt($(this).parent().siblings().children(".btnButton").attr("clicked")),o=parseInt($(this).attr("voteFor"));switch(currentVoteNum=parseInt($(this).siblings().html()),currentVoteNum_theOther=parseInt($(this).parent().siblings().children(".btnNumber").html()),""+[e,a,o]){case"0,0,0":currentVoteNum+=1,$(this).siblings().html(currentVoteNum).removeClass("color-button-secondary").addClass("color-button-danger"),$(this).attr("clicked",1).removeClass("color-button-secondary").addClass("color-button-danger");break;case"0,0,1":currentVoteNum+=1,$(this).siblings().html(currentVoteNum).removeClass("color-button-secondary").addClass("color-button-primary"),$(this).attr("clicked",1).removeClass("color-button-secondary").addClass("color-button-primary");break;case"0,1,0":currentVoteNum+=1,$(this).siblings().html(currentVoteNum).removeClass("color-button-secondary").addClass("color-button-danger"),$(this).attr("clicked",1).removeClass("color-button-secondary").addClass("color-button-danger"),--currentVoteNum_theOther,$(this).parent().siblings().children(".btnNumber").html(currentVoteNum_theOther).removeClass("color-button-primary").addClass("color-button-secondary"),$(this).parent().siblings().children(".btnButton").attr("clicked",0).removeClass("color-button-primary").addClass("color-button-secondary");break;case"0,1,1":currentVoteNum+=1,$(this).siblings().html(currentVoteNum).removeClass("color-button-secondary").addClass("color-button-primary"),$(this).attr("clicked",1).removeClass("color-button-secondary").addClass("color-button-primary"),--currentVoteNum_theOther,$(this).parent().siblings().children(".btnNumber").html(currentVoteNum_theOther).removeClass("color-button-danger").addClass("color-button-secondary"),$(this).parent().siblings().children(".btnButton").attr("clicked",0).removeClass("color-button-danger").addClass("color-button-secondary");break;case"1,0,0":--currentVoteNum,$(this).siblings().html(currentVoteNum).removeClass("color-button-danger").addClass("color-button-secondary"),$(this).attr("clicked",0).removeClass("color-button-danger").addClass("color-button-secondary");break;case"1,0,1":--currentVoteNum,$(this).siblings().html(currentVoteNum).removeClass("color-button-primary").addClass("color-button-secondary"),$(this).attr("clicked",0).removeClass("color-button-primary").addClass("color-button-secondary");break;default:console.error("fatal error.")}$.post(path_http+"proposalVote.php",{pid:t,position:o},()=>{"E3"==data&&($(".eventAlertModalMsg").html(text_no_enough_balance),$("#eventAlertModal").modal("show"),$(".eventAlertCancelBtn").click(()=>{location.reload()}))})}),$(".deleteProposalBtn").on("click",function(){var t=$(this).parent().attr("pid");$.post(path_http+"deleteProposal.php",{pid:t},()=>{location.reload()})}),$("#signupModal").on("show.bs.modal",function(){getNewNames(3)}),$("#refreshBtn").click(()=>{$("#refreshBtn").addClass("rotateit"),setTimeout(()=>{$("#refreshBtn").removeClass("rotateit")},500),getNewNames(3)}),$("#confirmTransfer").click(function(){var t=$("#toWallet").val(),e=$("#amount").val(),a=$("#note").val();t?e?($(this).children().attr("class","fa-solid fa-circle-notch fa-spin"),$.post(path_http+"transfer.php",{toWallet:t,amount:e,note:a},function(t){switch(t){case"E1":$(".eventAlertModalMsg").html(text_login_please),$("#eventAlertModal").modal("show"),$(".eventAlertCancelBtn").click(()=>{location.reload()});case"E2":setTimeout(`$("#confirmTransfer").children().attr("class", "fa-solid fa-xmark");$("#uinfo").html(${text_operation_failed}).attr("class","alert alert-danger");`,1e3);break;case"E3":setTimeout(`$("#confirmTransfer").children().attr("class", "fa-solid fa-xmark");$("#uinfo").html(${text_no_enough_balance}).attr("class","alert alert-danger");`,1e3);break;case"E5":setTimeout(`$("#confirmTransfer").children().attr("class", "fa-solid fa-xmark");$("#uinfo").html(${text_error_transfer_address}).attr("class","alert alert-danger");`,1e3);break;default:$("#confirmTransfer").children().attr("class","fa-solid fa-check"),$(".balanceValue").html("🍟"+parseInt(t)),$("#uinfo").html(text_transfer_success).attr("class","alert alert-success"),location.reload()}})):$("#uinfo").html(text_error_transfer_amount).attr("class","alert alert-danger"):$("#uinfo").html(text_error_transfer_address).attr("class","alert alert-danger")}),$(".switchAvatar").on("click",function(){var t=$(this).parent().parent().attr("aid");$.post(path_http+"switchToAvatar.php",{aid:t},t=>{switch(t){case"E1":$(".eventAlertModalMsg").html(text_login_please),$("#eventAlertModal").modal("show"),$(".eventAlertCancelBtn").click(()=>{location.reload()});break;case"E2":$(".eventAlertModalMsg").html(text_operation_failed),$("#eventAlertModal").modal("show"),$(".eventAlertCancelBtn").click(()=>{location.reload()});break;default:$(".eventAlertModalMsg").html(text_switch_avatar_success),$("#eventAlertModal").modal("show")}})}),$(".addAvatarBtn").click(function(){"0"==$(".addAvatarBtn").attr("clicked")?($(".addAvatarBtn").css("transform","rotate(45deg)"),$(".addAvatarBtn").attr("clicked","1"),getNewNames(3)):($(".addAvatarBtn").css("transform","rotate(0deg)"),$(".addAvatarBtn").attr("clicked","0"))}),$("#selectAvatarBtn").click(()=>{$("#avatarNameDisplay").html($("#avatar_chinese_"+$("input[name='avatar']:checked").val()).html())}),$("#addNewAvatarBtn").click(function(){var t="#avatar_chinese_"+$("input[name='avatar']:checked").val(),e="#avatar_english_"+$("input[name='avatar']:checked").val(),a=$(e).parent().prev().attr("md5"),t=$(t).html(),e=$(e).html();$.post(path_http+"addNewAvatar.php",{avatar_cn:t,avatar_en:e,md5:a},function(t){switch(t){case"E1":$(".eventAlertModalMsg").html(text_login_please),$("#eventAlertModal").modal("show"),$(".eventAlertCancelBtn").click(()=>{location.reload()});break;case"E2":$(".eventAlertModalMsg").html(text_operation_failed),$("#eventAlertModal").modal("show"),$(".eventAlertCancelBtn").click(()=>{location.reload()});break;case"E3":$(".eventAlertModalMsg").html(text_no_enough_balance),$("#eventAlertModal").modal("show"),$(".eventAlertCancelBtn").click(()=>{location.reload()});break;default:location.reload()}})}),$("#contributionBtn").click(function(){var t=parseInt($("input[name='contribution']:checked").val()),e=$("#contributeModal").attr("pouid"),a=$("#contributeModal").attr("poavatar"),o=$("#contributeModal").attr("tid"),l=$(".text-title").html();$.post(path_http+"contribute.php",{tid:o,amount:t,reciever:e,recieverAvatar:a,threadTitle:l},function(t){switch(t){case"E1":$(".eventAlertModalMsg").html(text_login_please),$("#eventAlertModal").modal("show"),$(".eventAlertCancelBtn").click(()=>{location.reload()});break;case"E3":$(".eventAlertModalMsg").html(text_no_enough_balance),$("#eventAlertModal").modal("show"),$(".eventAlertCancelBtn").click(()=>{location.reload()});break;default:location.reload()}})}),$("#verifyEmailBtn").click(function(){var t=$(this).attr("avatar"),e=$("#e").val(),a=$(this).attr("token"),o=$(this).attr("username");$("#veriftEmailBtnSpinner").css({display:"inherit"}),setTimeout(()=>{$("#veriftEmailBtnSpinner").css({display:"none"})},500),$.post(path_http+"mailVerifyOnce.php",{avatar:t,email:e,token:a,username:o}),$("#emailHelp").html(text_sent_verify_mail)}),$("#ccpwd").submit(()=>{var t=$("#o").val(),e=$("#np").val(),a=$("#r").val();return e.length<5||16<e.length?$("#cpwd").attr("class","alert alert-danger").html(text_error_password_length):e!=a?$("#cpwd").attr("class","alert alert-danger").html(text_error_different_password):t==e?$("#cpwd").attr("class","alert alert-danger").html(text_error_same_password):changePassword(t,e),!1}),$("#loginBtnConfirm").click(()=>{var t=$(".username").val(),e=$(".password").val();e.length<5||16<e.length?($("#passwordDescription").addClass("shakeit").html(text_error_password_length),setTimeout(()=>{$("#emailHelp").removeClass("shakeit")},500)):$.post(path_http+"loginAct.php",{username:t,password:e},function(t){switch(t){case"E0":location.reload();break;case"E2":$("#passwordDescription").addClass("shakeit").html(text_error_wrong_name_or_password),setTimeout(()=>{$("#emailHelp").removeClass("shakeit")},500);break;default:location.reload()}})}),$("#signupBtnConfirm").click(()=>{var t=$(".usernameReg").val(),e=$(".emailReg").val(),a="#avatar_chinese_"+$("input[name='avatar']:checked").val(),o="#avatar_english_"+$("input[name='avatar']:checked").val(),a=$(a).html(),l=$(o).html(),o=$(o).parent().prev().attr("md5"),r=$(".passwordReg").val(),n=$(".repeatReg").val();""==t||""==e?($("#emailHelp").addClass("shakeit").html(text_registering_air),setTimeout(()=>{$("#emailHelp").removeClass("shakeit")},500)):/^[a-zA-Z0-9_-]{1,15}$/.test(t)?/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/.test(e)?r.length<6||16<r.length?($("#passwordDescriptionReg").addClass("shakeit").html(text_error_password_length),setTimeout(()=>{$("#passwordDescriptionReg").removeClass("shakeit")},500)):r!==n?($("#passwordDescriptionReg").addClass("shakeit").html(text_error_different_password),setTimeout(()=>{$("#passwordDescriptionReg").removeClass("shakeit")},500)):$.post(path_http+"regAct.php",{email:e,avatar_cn:a,avatar_en:l,md5:o,username:t,password:r},function(t){switch(t){case"E0":console.log(!1),$("#signupModal").modal("hide"),$("#alertModal").modal("show");break;case"E10":$("#emailHelp").addClass("shakeit").html(text_error_taken_email),setTimeout(()=>{$("#emailHelp").removeClass("shakeit")},500);break;case"E11":$("#passwordDescriptionReg").addClass("shakeit").html(text_error_password_length),setTimeout(()=>{$("#passwordDescriptionReg").removeClass("shakeit")},500);break;case"success":$("#signupModal").modal("hide"),location.reload();break;default:console.log(t)}}):($("#emailHelp").addClass("shakeit").html(text_error_wrong_mail),setTimeout(()=>{$("#emailHelp").removeClass("shakeit")},500)):($("#emailHelp").addClass("shakeit").html(text_error_wrong_username),setTimeout(()=>{$("#emailHelp").removeClass("shakeit")},500))}),$(".banUser").each(function(){$(this).on("click",function(){var t=$(this).parent("td").attr("uid");console.log(t),$.post(path_http+"ban.php",{uid:t,ban:1},function(t){console.log(t),$(".eventAlertModalMsg").html(text_banned_for_days),$("#eventAlertModal").modal("show"),$(".eventAlertCancelBtn").html(text_confirm).click(()=>{location.reload()})})})}),$(".unBanUser").each(function(){$(this).on("click",function(){var t=$(this).parent("td").attr("uid");console.log(t),$.post(path_http+"ban.php",{uid:t,ban:0},function(t){console.log(t),$(".eventAlertModalMsg").html(text_unbanned),$("#eventAlertModal").modal("show"),$(".eventAlertCancelBtn").html(text_confirm).click(()=>{location.reload()})})})}),$(".levelChange").each(function(){$(this).on("click",function(){var t=$(this).parent("td").attr("uid"),e=parseInt($(this).parent("td").attr("group"))+parseInt($(this).attr("level"));$.post("group.php",{uid:t,group:e},function(t){console.log(t),$(".eventAlertModalMsg").html(text_changed_user_level),$("#eventAlertModal").modal("show"),$(".eventAlertCancelBtn").html(text_confirm).click(()=>{location.reload()})})})}),$("#daily-checkin").click(function(){$.post(path_http+"checkin.php",function(t){switch(t){case"success":$("#daily-checkin").parent().remove();var e=parseInt($("#balance-value").attr("money"))+10;$(".balanceValue").html("🍟<b>"+e+"</b>");break;case"E14":$("#daily-checkin").parent().remove()}})}),$("#verifyWikiBtn").click(function(){var t=$("#verifyNameInput").val(),e=$("#verifyPasswordInput").val();e?$.post(path_http+"wikiVerify.php",{userName:t,userPassword:e},function(t){switch(t){case"E1":text_login_please;break;case"E2":$("#passwordDescription").html(text_error_wrong_name_or_password);break;case"E10":return void $("#passwordDescription").html(text_has_been_bound);case"success":location.reload()}}):$("#passwordDescription").html(text_password_please)}),$("#newItemBtn").click(function(){var t=$("#newItemTitle").val(),e=$("#newItemSubtitle").val(),a=$("#newItemContent").val(),o=$("#newItemSvg").val(),l=$("#newItemRarity").val(),r=$("#newItemPrice").val(),n=$("#newItemAmount").val();$.post(path_http+"addNewItem.php",{title:t,subtitle:e,content:a,svg:o,rarity:l,price:r,amount:n},function(t){console.log(t)})}),$("#verifyAfdian").click(()=>{window.location.href=path_aifadian_oauth})});